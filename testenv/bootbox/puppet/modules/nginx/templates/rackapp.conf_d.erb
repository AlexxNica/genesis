# tumblr rack app: <%= @name %>
#

<% upstream = @name.sub '::', '_' %> 

upstream <%= upstream %> { server unix:/var/run/<%= upstream %>/unicorn.sock fail_timeout=0; }

server {
  listen      <%= nginx_port ||= 8000 %>;
  server_name _;

  keepalive_timeout    1;
  client_max_body_size 1G;

  root /<%= @web_root ||= upstream %>/public;

  try_files $uri @<%= @web_root ||= upstream %>;

  location @<%= @web_root ||= upstream %> {
    proxy_redirect   off;
    proxy_set_header Host $http_host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    
    proxy_pass http://<%= upstream %>;
  }

}

